webshims.register("filereader",function(a,b){"use strict";!function(){var c=window.swfmini||window.swfobject,d=a.Callbacks("once unique memory"),e=0,f=null;if(window.FileReader)return a.fn.fileReader=function(){return this},void 0;a.fn.fileReader=function(b){if(this.length){b=a.extend(a.fn.fileReader.defaults,b);var c=this;d.add(function(){return g(c,b)}),a.isFunction(b.callback)&&d.add(b.callback),FileAPIProxy.ready||FileAPIProxy.init(b)}return this},a.fn.fileReader.defaults={id:"fileReaderSWFObject",multiple:null,accept:null,label:null,extensions:null,filereader:"files/filereader.swf",expressInstall:null,debugMode:!1,callback:!1};var g=function(b,c){return b.each(function(b,d){d=a(d);var g,h,i,j=d.attr("id");j||(j="flashFileInput"+e,d.attr("id",j),e++),g=d.prop("multiple"),h=d.data("swfaccept")||d.prop("accept")||c.accept,i=d.jProp("labels").map(function(){return a(this).text()}).get().join(" ")||d.data("swflabel")||c.label,FileAPIProxy.inputs[j]=d,FileAPIProxy.swfObject.add(j,g,h,i,c.extensions),d.css("z-index",0).mouseover(function(a){j!==f&&(a=a||window.event,f=j,FileAPIProxy.swfObject.mouseover(j),FileAPIProxy.container.height(d.outerHeight()).width(d.outerWidth()).css(d.offset()))}).click(function(a){return a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),!1})})};window.FileAPIProxy={ready:!1,_inititalized:!1,init:function(b){var e=this;this.debugMode=b.debugMode,this.container||(this.container=a("<div>").attr("id",b.id).wrap("<div>").parent().css({position:"fixed",width:"1px",height:"1px",display:"inline-block",background:"transparent","z-index":99999}).on("mouseover mouseout mousedown mouseup",function(b){f&&a("#"+f).trigger(b.type)}).appendTo("body"),c.embedSWF(b.filereader,b.id,"100%","100%","10",b.expressInstall,{debugMode:b.debugMode?!0:""},{wmode:"transparent",allowScriptAccess:"sameDomain"},{},function(b){e.swfObject=b.ref,a(e.swfObject).css({display:"block",outline:0}).attr("tabindex",0),e.ready=b.success&&"function"==typeof b.ref.add,e.ready&&d.fire()}))},swfObject:null,container:null,inputs:{},readers:{},onFileInputEvent:function(a){if(this.debugMode&&console.info("FileInput Event ",a.type,a),a.target in this.inputs){var c=this.inputs[a.target];a.target=c[0],"change"===a.type&&b.data(a.target,"fileList",new FileList(a.files)),c.trigger(a)}window.focus()},onFileReaderEvent:function(a){if(this.debugMode&&console.info("FileReader Event ",a.type,a,a.target in this.readers),a.target in this.readers){var b=this.readers[a.target];a.target=b,b._handleFlashEvent.call(b,a)}},onFileReaderError:function(a){this.debugMode&&console.log(a)},onSWFReady:function(){return this.container.css({position:"absolute"}),this.ready="function"==typeof this.swfObject.add,this.ready&&d.fire(),!0}},window.FileReader=function(){this.EMPTY=0,this.LOADING=1,this.DONE=2,this.readyState=0,this.result=null,this.error=null,this.onloadstart=null,this.onprogress=null,this.onload=null,this.onabort=null,this.onerror=null,this.onloadend=null,this._callbacks={loadstart:a.Callbacks("unique"),progress:a.Callbacks("unique"),abort:a.Callbacks("unique"),error:a.Callbacks("unique"),load:a.Callbacks("unique"),loadend:a.Callbacks("unique")},this._id=null},window.FileReader.prototype={readAsBinaryString:function(a){this._start(a),FileAPIProxy.swfObject.read(a.input,a.name,"readAsBinaryString")},readAsText:function(a){this._start(a),FileAPIProxy.swfObject.read(a.input,a.name,"readAsText")},readAsDataURL:function(a){this._start(a),FileAPIProxy.swfObject.read(a.input,a.name,"readAsDataURL")},readAsArrayBuffer:function(){throw"Whoops FileReader.readAsArrayBuffer is unimplemented"},abort:function(){this.result=null,this.readyState!==this.EMPTY&&this.readyState!==this.DONE&&FileAPIProxy.swfObject.abort(this._id)},addEventListener:function(a,b){a in this._callbacks&&this._callbacks[a].add(b)},removeEventListener:function(a,b){a in this._callbacks&&this._callbacks[a].remove(b)},dispatchEvent:function(b){if(b.target=this,b.type in this._callbacks){var c=this["on"+b.type];a.isFunction(c)&&c(b),this._callbacks[b.type].fire(b)}return!0},_register:function(a){this._id=a.input+"."+a.name,FileAPIProxy.readers[this._id]=this},_start:function(a){if(this._register(a),this.readyState===this.LOADING)throw{type:"InvalidStateError",code:11,message:"The object is in an invalid state."}},_handleFlashEvent:function(a){switch(a.type){case"loadstart":this.readyState=this.LOADING;break;case"loadend":this.readyState=this.DONE;break;case"load":this.readyState=this.DONE,this.result=FileAPIProxy.swfObject.result(this._id);break;case"error":this.result=null,this.error={name:"NotReadableError",message:"The File cannot be read!"}}this.dispatchEvent(new FileReaderEvent(a))}},window.FileReaderEvent=function(a){this.initEvent(a)},window.FileReaderEvent.prototype={initEvent:function(b){a.extend(this,{type:null,target:null,currentTarget:null,eventPhase:2,bubbles:!1,cancelable:!1,defaultPrevented:!1,isTrusted:!1,timeStamp:(new Date).getTime()},b)},stopPropagation:function(){},stopImmediatePropagation:function(){},preventDefault:function(){}},window.FileList=function(a){if(a){for(var b=0;b<a.length;b++)this[b]=a[b];this.length=a.length}else this.length=0},window.FileList.prototype={item:function(a){return a in this?this[a]:null}}}(),b.defineNodeNameProperty("input","files",{prop:{writeable:!1,get:function(){return"file"!=this.type?null:(a(this).is(".ws-filereader")||b.error("please add the 'ws-filereader' class to your input[type='file'] to implement files-property"),b.data(this,"fileList")||b.data(this,"fileList",new FileList))}}}),b.defineNodeNamesBooleanProperty("input","multiple"),a.fn.fileReader.defaults.filereader=b.cfg.basePath+"swf/filereader.swf";var c=["DOM"];b.modules["form-core"].loaded&&c.push("forms"),b.ready(c,function(){b.addReady(function(b){a('input[type="file"].ws-filereader',b).fileReader()})})});